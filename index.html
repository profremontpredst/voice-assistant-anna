<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI –ë–æ—Ç: –¢–µ–∫—Å—Ç –∏ –ì–æ–ª–æ—Å</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(145deg, #0d1b2a, #1b263b);
      font-family: Arial, sans-serif;
      color: #fff;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tab-button {
      padding: 10px 20px;
      border: 1px solid #444;
      background-color: transparent;
      color: #ccc;
      cursor: pointer;
      margin: 0 10px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    .tab-button.active {
  background-color: #00f2ff;
  color: #000;
      background-color: #00f2ff;
      color: #fff;
    }
    .bots-wrapper {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .panel {
      flex: 1 1 400px;
      background-color: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 20px;
      opacity: 0.4;
      transition: all 0.3s ease;
    }
    .panel.active {
      opacity: 1;
    }
    .chat-box {
  min-height: 200px;
      max-height: 300px;
      overflow-y: auto;
      background-color: rgba(0,0,0,0.3);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
    }
    .chat-input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
    }
    .waveform {
      width: 100%;
      height: 100px;
      background-image: linear-gradient(to right, #00f2ff 50%, transparent 0%);
      background-size: 20px 100%;
      animation: none;
    }
    .waveform.listening {
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    .mic-button {
      display: block;
      margin: 20px auto 0;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background-color: #00f2ff;
      border: none;
      background-image: url('https://img.icons8.com/ios-filled/50/ffffff/microphone.png');
      background-position: center;
      background-repeat: no-repeat;
      background-size: 50%;
      cursor: pointer;
    }
    .status {
      text-align: center;
      margin-top: 10px;
      font-size: 16px;
      color: #00f2ff;
    }
    .footer-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .footer-buttons button {
      padding: 10px 20px;
      background-color: transparent;
      border: 1px solid #00f2ff;
      color: #00f2ff;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .footer-buttons button:hover {
      background-color: #00f2ff;
      color: #000;
    }
    .features {
      margin-top: 80px;
      text-align: center;
    }
    .features h2 {
      font-size: 28px;
      margin-bottom: 40px;
    }
    .features-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    .feature-item {
      background-color: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      width: 200px;
      text-align: center;
      border: 1px solid rgba(0, 242, 255, 0.3);
    }
    .feature-item img {
      width: 40px;
      margin-bottom: 10px;
    }
    .feature-caption {
      font-size: 16px;
    }
    .smart-block {
      margin-top: 100px;
      background-color: rgba(255,255,255,0.03);
      border-radius: 20px;
      padding: 40px 20px;
      text-align: center;
    }
    .smart-block h2 {
      font-size: 28px;
      margin-bottom: 20px;
    }
    .smart-block ul {
      list-style: none;
      padding: 0;
      margin: 0 auto 30px;
      max-width: 600px;
      text-align: left;
    }
    .smart-block li {
      margin-bottom: 12px;
      padding-left: 24px;
      position: relative;
    }
    .smart-block li::before {
      content: "‚úî";
      position: absolute;
      left: 0;
      color: #00f2ff;
    }
    .smart-block .bottom-text {
      font-size: 16px;
      opacity: 0.7;
    }
    .value-prop {
      margin-top: 100px;
      text-align: center;
      padding: 40px 20px;
      background-color: rgba(255,255,255,0.02);
      border-radius: 20px;
    }
    .value-prop h2 {
      font-size: 28px;
      margin-bottom: 30px;
    }
    .value-grid {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }
    .value-item {
      width: 250px;
      background-color: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(0, 242, 255, 0.3);
    }
    .value-item img {
      width: 40px;
      margin-bottom: 10px;
    }
    .value-item p {
      font-size: 16px;
    }
    @media (max-width: 768px) {
      .bots-wrapper {
        flex-direction: column;
      }
      .bots-wrapper .panel {
        display: none;
      }
      .bots-wrapper .panel.active {
        display: block;
        opacity: 1;
      }
      .smart-block ul {
        padding: 0 10px;
      }
      .value-grid {
        flex-direction: column;
        align-items: center;
      }
      .value-item {
        width: 90%;
      }
    }
  
    .how-we-work {
      margin-top: 100px;
      padding: 40px 20px;
      background-color: rgba(255,255,255,0.03);
      border-radius: 20px;
      text-align: left;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    .how-we-work h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 20px;
    }
    .how-we-work ul {
      list-style: none;
      padding: 0;
    }
    .how-we-work li {
      margin-bottom: 20px;
      padding-left: 24px;
      position: relative;
    }
    .how-we-work li::before {
      content: "‚úî";
      position: absolute;
      left: 0;
      color: #00f2ff;
    }

</style>
</head>
<div style="text-align: center; position: relative; z-index: 10; padding: 20px 0;">
  <img src="https://i.ibb.co/LDrthZD4/87364622-f999-476a-9c1d-d778dc50c6a8-1.png"
       alt="Anna Logo"
       style="height: 100px; object-fit: contain;" />
</div>      
  <div class="container">
    <div class="tabs">
      <button class="tab-button active" onclick="switchTab('text')">–¢–µ–∫—Å—Ç–æ–≤—ã–π –±–æ—Ç</button>
      <button class="tab-button" onclick="switchTab('voice')">–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç</button>
    </div>
    <div class="bots-wrapper">
      <div id="text" class="panel active">
        <div class="chat-box"></div>
        <div style="display: flex; gap: 10px;">
  <input class="chat-input" id="chatInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex: 1;">
  <button onclick="sendMessage()" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å" style="padding:10px 20px; border:none; border-radius:8px; background-color:#00f2ff; color:#000; cursor:pointer;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="18" height="18" fill="black">
      <path d="M476 3.8c-3.6-1.5-7.6-1.5-11.2 0L36.3 189.7c-5.9 2.4-9.8 8.1-9.8 14.3s3.9 11.9 9.8 14.3l138.3 57.6 57.6 138.3c2.4 5.9 8.1 9.8 14.3 9.8 6.2 0 11.9-3.9 14.3-9.8L508.2 47.2c3.7-8.7-.2-18.6-9.6-23.4z"/>
    </svg>
  </button>
  <button onclick="startTextVoice()" title="–ì–æ–ª–æ—Å–æ–º" style="padding:10px 20px; border:none; border-radius:8px; background-color:#00f2ff; color:#000; cursor:pointer;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" width="18" height="18" fill="black">
      <path d="M192 256c0 17.7-14.3 32-32 32s-32-14.3-32-32V128c0-17.7 14.3-32 32-32s32 14.3 32 32V256zM160 320c35.3 0 64-28.7 64-64V128a64 64 0 1 0-128 0V256c0 35.3 28.7 64 64 64zm56 32H104c-13.3 0-24 10.7-24 24s10.7 24 24 24h24v56c0 13.3 10.7 24 24 24s24-10.7 24-24V400h24c13.3 0 24-10.7 24-24s-10.7-24-24-24z"/>
    </svg>
  </button>
</div>
      </div>
      <div id="voice" class="panel">
        <div class="waveform" id="waveform"></div>
        <button class="mic-button" onclick="startVoiceDialog()"></button>
        <div class="status" id="voice-status">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</div>
      </div>
    </div>
    <div class="footer-buttons">
      <button onclick="sendHotkey('–•–æ—á—É —Å–µ–±–µ —Ç–∞–∫–æ–≥–æ')">–•–æ—á—É —Å–µ–±–µ —Ç–∞–∫–æ–≥–æ</button>
      <button onclick="sendHotkey('–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç?')">–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç?</button>
      <button onclick="sendHotkey('–¢–µ—Å—Ç-–¥–æ—Å—Ç—É–ø')">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–µ—Å—Ç</button>
    </div>
    <div class="features">
      <h2>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h2>
      <div class="features-grid">
        <div class="feature-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/chat--v1.png" />
          <div class="feature-caption">–û–±—â–µ–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</div>
        </div>
        <div class="feature-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/code--v1.png" />
          <div class="feature-caption">–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π —Å–∞–π—Ç–∞</div>
        </div>
        <div class="feature-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/order-history.png" />
          <div class="feature-caption">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤</div>
        </div>
        <div class="feature-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/share.png" />
          <div class="feature-caption">–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ CRM</div>
        </div>
        <div class="feature-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/combo-chart--v1.png" />
          <div class="feature-caption">–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞</div>
        </div>
        <div class="feature-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/checklist.png" />
          <div class="feature-caption">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É</div>
        </div>
        <div class="feature-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/positive-dynamic.png" />
          <div class="feature-caption">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Å —Å–∞–π—Ç–∞</div>
        </div>
        <div class="feature-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/money.png" />
          <div class="feature-caption">–î–µ—à–µ–≤–ª–µ –∂–∏–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</div>
        </div>
      </div>
      <!-- –ë–ª–æ–∫ –∑–≤–æ–Ω—è—â–µ–≥–æ –ò–ò-–±–æ—Ç–∞ -->
<div class="voice-ai-block" style="margin-top: 80px; background-color: rgba(255,255,255,0.03); padding: 40px 20px; border-radius: 20px; text-align: center;">
  <img src="https://img.icons8.com/ios-filled/50/00f2ff/phone.png" style="width: 40px; margin-bottom: 15px;" />
  <h2 style="font-size: 26px; margin-bottom: 10px;">–ò–ò —Å–∞–º –∑–≤–æ–Ω–∏—Ç –∏ –≤–µ–¥—ë—Ç –¥–∏–∞–ª–æ–≥</h2>
  <p style="max-width: 600px; margin: 0 auto 20px; font-size: 16px; opacity: 0.85;">
    –ü–µ—Ä–µ–∑–≤–∞–Ω–∏–≤–∞–µ—Ç –ø–æ –∑–∞—è–≤–∫–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –±–∞–∑–µ. –ü–æ–Ω–∏–º–∞–µ—Ç —Ä–µ—á—å, –æ—Ç–≤–µ—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–º, –¥–≤–∏–≥–∞–µ—Ç —Å–¥–µ–ª–∫–∏ –≤ CRM.
  </p>
  <button onclick="sendHotkey('–•–æ—á—É –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω—è—â–µ–≥–æ –±–æ—Ç–∞')" style="padding: 12px 24px; background-color: #00f2ff; border: none; border-radius: 8px; color: #000; font-size: 16px; cursor: pointer;">
    –•–æ—á—É –Ω–∞ —Ç–µ—Å—Ç
  </button>
  <div style="margin-top: 10px; font-size: 14px; opacity: 0.6;">–°–∫–æ—Ä–æ –Ω–∞ —Å–∞–π—Ç–µ</div>
</div>
    </div>
    <div class="smart-block">
      <h2>–£–º–Ω—ã–π —Å–∞–π—Ç —Å –ò–ò ‚Äî</h2>
      <ul>
        <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞ –ø–µ—Ä–≤–æ–π –ª–∏–Ω–∏–∏</li>
        <li>–ß–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª –∏ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ</li>
        <li>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞—è–≤–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è CRM ‚Äî –±–µ–∑ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</li>
      </ul>
      <div class="bottom-text">–°—Ç–∞—Ä—ã–µ —Å–∞–π—Ç—ã ‚Äî —ç—Ç–æ –æ–±–ª–æ–∂–∫–∞. –ù–æ–≤—ã–µ —Å–∞–π—Ç—ã ‚Äî —ç—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏.</div>
    </div>
    <div class="value-prop">
      <h2>–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ</h2>
      <div class="value-grid">
        <div class="value-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/light-on.png" />
          <p>–°–∞–π—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</p>
        </div>
        <div class="value-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/brainstorm.png" />
          <p>–ò–ò, –ø–æ–Ω–∏–º–∞—é—â–∏–π –∫–ª–∏–µ–Ω—Ç–∞ –∏ –ø–æ–º–æ–≥–∞—é—â–∏–π –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ</p>
        </div>
        <div class="value-item">
          <img src="https://img.icons8.com/ios-filled/50/00f2ff/shield.png" />
          <p>–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é</p>
        </div>
      </div>
    </div>
  
<div class="how-we-work">
  <h2>–ö–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º</h2>
  <ul>
    <li><strong>–ò–∑—É—á–∞–µ–º –∑–∞–¥–∞—á—É</strong><br>–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–ª–∏, —Ñ–æ—Ä–º–∞—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.</li>
    <li><strong>–°–æ–∑–¥–∞—ë–º —É–º–Ω—ã–π —Å–∞–π—Ç –∏–ª–∏ –≤–Ω–µ–¥—Ä—è–µ–º –ò–ò –Ω–∞ –≤–∞—à —Å–∞–π—Ç</strong><br>–†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∞–π—Ç —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º –ò–ò –≤ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç.</li>
    <li><strong>–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º –Ω–µ–π—Ä–æ—Å–µ—Ç–∏</strong><br>–ó–∞–ø—É—Å–∫–∞–µ–º GPT, –≥–æ–ª–æ—Å–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, CRM, Google Sheets –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É.</li>
    <li><strong>–ü–æ–¥–∫–ª—é—á–∞–µ–º –¥–æ–º–µ–Ω –∏ –∑–∞–ø—É—Å–∫–∞–µ–º</strong><br>–°–∞–π—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –ù–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã.</li>
    <li><strong>–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö</strong><br>–í—Å–µ –∑–∞—è–≤–∫–∏, –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∞–º. –î–æ—Å—Ç—É–ø ‚Äî —Ç–æ–ª—å–∫–æ —É –≤–∞—Å.</li>
  </ul>
</div>

</div>
  <script>
    function switchTab(type) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.querySelector('.tab-button[onclick*="' + type + '"]').classList.add('active');
      document.getElementById(type).classList.add('active');
    }
    function sendHotkey(message) {
      const isVoice = document.getElementById('voice').classList.contains('active');
      const mode = isVoice ? '–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç' : '–¢–µ–∫—Å—Ç–æ–≤—ã–π –±–æ—Ç';
      alert(`–°–æ–æ–±—â–µ–Ω–∏–µ –≤ ${mode}: ${message}`);
    }
    function startVoiceDialog() {
      const status = document.getElementById('voice-status');
      const waveform = document.getElementById('waveform');
      status.innerText = '–î–∏–∞–ª–æ–≥ –Ω–∞—á–∞—Ç. –ì–æ–≤–æ—Ä–∏—Ç–µ...';
      waveform.classList.add('listening');
    }
  </script>
  <script>
const OPENAI_PROXY_URL = "https://openai-gpt-proxy-mcnj.onrender.com/gpt";
const ELEVENLABS_STREAM_URL = "https://elevenlabs-proxy-1o1s.onrender.com/stream";
const LEAD_URL = "https://openai-gpt-proxy-mcnj.onrender.com/lead";

const chatBox = document.querySelector(".chat-box");
const chatInput = document.querySelector(".chat-input");
const micButton = document.querySelector(".mic-button");

let messages = [];
let userId = localStorage.getItem("userId") || "user_" + Math.random().toString(36).substr(2, 9);
localStorage.setItem("userId", userId);

function sendMessage() {
  if (!chatInput || chatInput.disabled) return;
  const text = chatInput.value.trim();
  if (!text) return;

  appendMessage(text, true);
  messages.push({ role: "user", content: text });
  chatInput.value = "";

  fetch(OPENAI_PROXY_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      messages,           // ‚ö°Ô∏è –≤—Å–µ–≥–¥–∞ –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è
      userId,
      mode: "text"
    })
  })
    .then(res => res.json())
    .then(data => {
      const reply = data?.choices?.[0]?.message?.content || "–û—à–∏–±–∫–∞";
      appendMessage(reply, false);
      messages.push({ role: "assistant", content: reply });

      if (data?.triggerForm) {
        document.getElementById("leadTitle").innerText = reply;
        document.getElementById("leadPopup").style.display = "block";
      }
    })
    .catch(err => {
      appendMessage("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞", false);
      console.error(err);
    });
}

function appendMessage(text, isUser) {
  const msg = document.createElement("div");
  msg.className = "message " + (isUser ? "from-user" : "from-bot");
  msg.style.cssText = "margin-bottom:10px;padding:8px 12px;border-radius:10px;max-width:80%;background:" + (isUser ? "#00f2ff33" : "#ffffff22") + ";align-self:" + (isUser ? "flex-end" : "flex-start") + ";";
  msg.innerText = text;
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function startTextVoice() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "ru-RU";
  recognition.start();
  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript;
    chatInput.value = text;
    sendMessage();
  };
  recognition.onerror = () => {
    alert("–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è");
  };
}

let recognition;
let isListening = false;

function startVoiceDialog() {
  const status = document.getElementById("voice-status");
  const waveform = document.getElementById("waveform");

  if (isListening) {
    recognition.stop();
    status.innerText = "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å";
    waveform.classList.remove("listening");
    isListening = false;
    return;
  }

  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "ru-RU";
  recognition.continuous = true;
  recognition.interimResults = false;

  recognition.onstart = () => {
    status.innerText = "üé§ –°–ª—É—à–∞—é...";
    waveform.classList.add("listening");
    isListening = true;
  };

  recognition.onresult = async (event) => {
  const text = event.results[event.results.length - 1][0].transcript;
  status.innerText = "üó£ " + text;

  messages.push({ role: "user", content: text });

  try {
    const res = await fetch(OPENAI_PROXY_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        messages,           // ‚ö°Ô∏è –≤—Å–µ–≥–¥–∞ –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è
        userId,
        mode: "voice"
      })
    });

    const data = await res.json();
    const reply = data?.choices?.[0]?.message?.content || "–û—à–∏–±–∫–∞";

    messages.push({ role: "assistant", content: reply });
    speakText(reply);
  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ GPT:", err);
  }
};

  recognition.onend = () => {
    // ‚ö†Ô∏è —É–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ-—Å—Ç–∞—Ä—Ç —Ç—É—Ç, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç —Ü–∏–∫–ª!
    if (isListening) {
      // –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–º ‚Äî speakText —Å–∞–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç
    }
  };

  recognition.start();
}

async function speakText(text) {
  try {
    if (recognition && isListening) {
      recognition.stop(); // —Å—Ç–æ–ø–∞–µ–º –ø–æ–∫–∞ –≥–æ–≤–æ—Ä–∏–º
    }

    const r = await fetch(ELEVENLABS_STREAM_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    if (!r.ok) {
      console.error("TTS bad status:", r.status);
      return;
    }

    const blob = await r.blob();
    const url  = URL.createObjectURL(blob);
    const a    = new Audio(url);
    a.playsInline = true;

    a.onended = () => {
      URL.revokeObjectURL(url);
      // üî• —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ—á–∏ ‚Äî —Å–Ω–æ–≤–∞ —Å—Ç–∞—Ä—Ç—É–µ–º –º–∏–∫—Ä–æ—Ñ–æ–Ω
      if (isListening && recognition) {
        recognition.start();
      }
    };

    await a.play().catch(()=>{});
  } catch (e) {
    console.error("speakText error:", e?.message || e);
  }
}
</script>
  <!-- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã + —Ñ–æ—Ä–º–∞ -->
<div class="integration-block" style="margin-top: 100px; background-color: rgba(255,255,255,0.03); border-radius: 20px; padding: 40px 20px; text-align: center;">
  <h2 style="font-size: 26px; color: #00f2ff; margin-bottom: 20px;">–ò–ò –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å –≤ –ª—é–±—ã–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã</h2>
  <p style="font-size: 16px; opacity: 0.85; max-width: 600px; margin: 0 auto 30px;">
    –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º –ò–ò –≤ Telegram, WhatsApp, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, Avito –∏ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å API. –ë–æ—Ç –æ–±—â–∞–µ—Ç—Å—è, –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞—è–≤–∫–∏, –ø—Ä–æ–¥–∞—ë—Ç –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ CRM.
  </p>
  <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;">
    <img src="https://img.icons8.com/ios-filled/50/00f2ff/telegram-app.png" width="40" alt="Telegram"/>
    <img src="https://img.icons8.com/ios-filled/50/00f2ff/whatsapp.png" width="40" alt="WhatsApp"/>
    <img src="https://img.icons8.com/ios-filled/50/00f2ff/vk-circled.png" width="40" alt="VK"/>
    <img src="https://img.icons8.com/ios-filled/50/00f2ff/domain.png" width="40" alt="Avito"/>
    <img src="https://img.icons8.com/ios-filled/50/00f2ff/api.png" width="40" alt="API"/>
  </div>
  <form onsubmit="event.preventDefault(); alert('–ó–∞—è–≤–∫–∞ –≤ –æ—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');" name="–ó–∞—è–≤–∫–∞ –≤ –æ—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂" style="display: flex; flex-direction: column; align-items: center; gap: 12px;">
    <input type="text" name="name" placeholder="–í–∞—à–µ –∏–º—è" required style="width: 100%; max-width: 400px; padding: 10px; border-radius: 8px; border: none;" />
    <input type="tel" name="phone" id="phone" placeholder="+7 (___) ___-__-__" required style="width: 100%; max-width: 400px; padding: 10px; border-radius: 8px; border: none;" />
    <textarea name="message" rows="3" placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∑–∞–¥–∞—á–∞" style="width: 100%; max-width: 400px; padding: 10px; border-radius: 8px; border: none;"></textarea>
    <button type="submit" style="padding: 12px 24px; background-color: #00f2ff; color: #000; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
      –°–≤—è–∑–∞—Ç—å—Å—è —Å –æ—Ç–¥–µ–ª–æ–º –ø—Ä–æ–¥–∞–∂
    </button>
  </form>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Å–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
<script src="https://unpkg.com/imask"></script>
<script>
  const phoneMask = IMask(document.getElementById('phone'), {
    mask: '+{7} (000) 000-00-00'
  });
</script>
<!-- –§—É—Ç–µ—Ä -->
<div class="footer">
  <div class="section">
    <div class="column">
      <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
      <div>üìû <a href="tel:+79937480725">+7 993 748-07-25</a> (WhatsApp)</div>
      <div>üí¨ Telegram: <a href="https://t.me/Anna_Marketing33">@Anna_Marketing33</a></div>
      <div>‚úâÔ∏è <a href="mailto:ann4-marketing@yandex.ru">ann4-marketing@yandex.ru</a></div>
    </div>
    <div class="column">
      <h3>–†–µ–∫–≤–∏–∑–∏—Ç—ã</h3>
      <div>–ò–ü –§–µ—Å—å–∫–æ–≤–∞ –ê–Ω–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞</div>
      <div>–û–ì–†–ù–ò–ü: 323330000039272</div>
      <div>–ò–ù–ù: 333802711900</div>
      <div>–Æ—Ä. –∞–¥—Ä–µ—Å: –≥. –í–ª–∞–¥–∏–º–∏—Ä, —É–ª. –ü–æ–ª–∏–Ω—ã –û—Å–∏–ø–µ–Ω–∫–æ, –¥. 21</div>
      <div class="bank-toggle" onclick="toggleBank()">–ü–æ–∫–∞–∑–∞—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</div>
      <div class="bank-details" id="bank">
        <div>–†/—Å: 40802810320000069222</div>
        <div>–ë–∞–Ω–∫: –û–û–û "–ë–∞–Ω–∫ –¢–æ—á–∫–∞"</div>
        <div>–ë–ò–ö: 044525104</div>
        <div>–ö/—Å: 30101810745374525104</div>
      </div>
    </div>
  </div>
</div>

<!-- –°—Ç–∏–ª–∏ —Ñ—É—Ç–µ—Ä–∞ -->
<style>
  .footer {
    background-color: rgba(255, 255, 255, 0.02);
    padding: 40px 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
    font-size: 14px;
    color: #fff;
  }
  .footer h3 {
    color: #00f2ff;
    margin-bottom: 20px;
    font-size: 18px;
  }
  .footer a {
    color: #00f2ff;
    text-decoration: none;
  }
  .footer a:hover {
    text-decoration: underline;
  }
  .footer .section {
    max-width: 1000px;
    margin: 0 auto;
    display: flex;
    flex-direction: row;
    gap: 60px;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  .footer .column {
    flex: 1;
    min-width: 280px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .bank-toggle {
    margin-top: 10px;
    color: #00f2ff;
    cursor: pointer;
  }
  .bank-details {
    display: none;
    margin-top: 10px;
    opacity: 0.7;
  }
  @media (max-width: 768px) {
    .footer .section {
      flex-direction: column;
      gap: 30px;
    }
  }
</style>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–∫–∞–∑–∞—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã" -->
<script>
  function toggleBank() {
    const el = document.getElementById('bank');
    el.style.display = el.style.display === 'block' ? 'none' : 'block';
  }
</script>
<!-- –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ -->
<div id="leadOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:9998;"></div>

<!-- —Ñ–æ—Ä–º–∞ -->
<div id="leadPopup" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background-color:#111; color:#fff; padding:20px; border-radius:16px; z-index:9999; max-width:400px; width:90%; box-shadow:0 0 20px #00f2ff;">
  <div id="leadTitle" style="margin-bottom:15px; font-size:16px; line-height:1.4;"></div>
  <input id="leadName" placeholder="–í–∞—à–µ –∏–º—è" style="width:100%; padding:10px; border-radius:8px; border:none; margin-bottom:10px;" />
  <input id="leadPhone" placeholder="+7 (___) ___-__-__" style="width:100%; padding:10px; border-radius:8px; border:none; margin-bottom:10px;" />
  <button id="leadSubmitBtn" style="width:100%; padding:12px; border:none; border-radius:8px; background-color:#00f2ff; color:#000; font-weight:bold; cursor:pointer;">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
</div>

<!-- –æ–∫–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ -->
<div id="leadThanks" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background-color:#111; color:#fff; padding:20px; border-radius:16px; z-index:10000; max-width:400px; width:90%; box-shadow:0 0 20px #00f2ff; text-align:center;">
  <div style="font-size:16px; line-height:1.4;">‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞—è–≤–∫—É, —Å–∫–æ—Ä–æ —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏</div>
</div>

<script src="https://unpkg.com/imask"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    IMask(document.getElementById("leadPhone"), {
      mask: "+{7} (000) 000-00-00"
    });

    // –∑–∞–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É/—Å–ø–∞—Å–∏–±–æ –∫–ª–∏–∫–æ–º –Ω–∞ —Ñ–æ–Ω
    document.getElementById("leadOverlay").addEventListener("click", () => {
      document.getElementById("leadPopup").style.display = "none";
      document.getElementById("leadThanks").style.display = "none";
      document.getElementById("leadOverlay").style.display = "none";
    });

    document.getElementById("leadSubmitBtn").addEventListener("click", async (e) => {
      e.preventDefault();
      const btn = e.target;
      if (btn.disabled) return;
      btn.disabled = true;

      const name = document.getElementById("leadName").value.trim();
      let phone = document.getElementById("leadPhone").value.replace(/\D/g, "");

      if (!name || phone.length < 10) {
        alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞");
        btn.disabled = false;
        return;
      }

      if (!Array.isArray(messages) || messages.length === 0) {
        alert("–°–Ω–∞—á–∞–ª–∞ –ø–æ–æ–±—â–∞–π—Ç–µ—Å—å —Å –±–æ—Ç–æ–º");
        btn.disabled = false;
        return;
      }

      // –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–æ–º–µ—Ä
      phone = "+7" + phone.slice(-10);

      const payload = { name, phone, userId, messages };

      // —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∞—Å–∏–±–æ
      document.getElementById("leadPopup").style.display = "none";
      document.getElementById("leadThanks").style.display = "block";
      document.getElementById("leadOverlay").style.display = "block";

      // —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –∑–∞–∫—Ä—ã–≤–∞–µ–º
      setTimeout(() => {
        document.getElementById("leadOverlay").style.display = "none";
        document.getElementById("leadThanks").style.display = "none";
        document.getElementById("leadName").value = "";
        document.getElementById("leadPhone").value = "";
      }, 3000);

      // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      try {
        await fetch("https://openai-gpt-proxy-mcnj.onrender.com/lead", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:", err);
      } finally {
        btn.disabled = false;
      }
    });
  });
</script>
  <style>
  .ai-float-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 70px;
    height: 70px;
    background-color: transparent;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    z-index: 99999;
    padding: 0;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  }

  .ai-float-button img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  #ai-chat-frame {
    position: fixed;
    bottom: 20px;
    right: 100px;
    width: 340px;
    height: 520px;
    border: none;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
    z-index: 99998;
    display: none;
  }

  @media (max-width: 768px) {
    #ai-chat-frame {
      bottom: 100px;
      right: 20px;
    }
  }
</style>

<script>
  window.onload = function () {
    const button = document.createElement('button');
    button.className = 'ai-float-button';
    button.title = '–û—Ç–∫—Ä—ã—Ç—å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞';

    const img = document.createElement('img');
    img.src = 'https://i.postimg.cc/mgP268Zt/96f08734-0442-48ea-bd9e-e3e25cb92060-1.png';
    img.alt = 'AI';

    button.appendChild(img);

    const iframe = document.createElement('iframe');
    iframe.id = 'ai-chat-frame';
    iframe.src = 'https://gpt-widget-4f6q.onrender.com?mode=text';
    iframe.allow = 'microphone';

    button.onclick = function () {
      iframe.style.display = (iframe.style.display === 'block') ? 'none' : 'block';
    };

    document.body.appendChild(button);
    document.body.appendChild(iframe);

    window.addEventListener("message", (event) => {
      if (event.data === "open-widget") {
        iframe.style.display = 'block';
      }
    });
  };
</script>
</body>
</html>
